---
// å®šä¹‰åŠŸèƒ½æŒ‰é’®ï¼ˆä¸å«å¼€å…³æœ¬èº«ï¼‰
const tools = [
  { icon: 'A', tooltip: 'å­—å·', action: 'fontSize' },
  { icon: 'ğŸŒ™', tooltip: 'æ¨¡å¼', action: 'theme' },
  { icon: 'â†‘', tooltip: 'é¡¶éƒ¨', action: 'top' },
  { icon: 'ğŸ™', tooltip: 'Github', link: 'https://github.com/AbelTomato' },
];
---

<div class="fixed bottom-6 right-6 z-50 flex flex-col-reverse items-center gap-3">
  <button
    id="main-toggle"
    class="z-50 flex h-12 w-12 items-center justify-center rounded-full bg-blue-600 text-white shadow-xl hover:bg-blue-700 transition-all active:scale-95"
    title="å±•å¼€/æ”¶èµ·èœå•"
  >
    <span class="text-2xl transition-transform duration-300" id="toggle-icon">ï¼‹</span>
  </button>

  <div 
  id="tools-container" 
  class="flex flex-col gap-3 transition-all duration-300 translate-y-10 opacity-0 pointer-events-none mb-3"
>
    {
      tools.map((item) => (
        item.link ? (
          <a
            href={item.link}
            target="_blank"
            rel="noopener noreferrer"
            class="group relative flex h-11 w-11 items-center justify-center rounded-full bg-gray-900 dark:bg-gray-700 text-white shadow-lg hover:scale-110 transition-all"
          >
            <span class="text-xl">{item.icon}</span>
            <span class="absolute right-full mr-3 whitespace-nowrap rounded bg-black/90 px-2 py-1 text-xs text-white opacity-0 group-hover:opacity-100 transition-opacity hidden md:block">
              {item.tooltip}
            </span>
          </a>
        ) : (
          <button
            data-action={item.action}
            class="group relative flex h-11 w-11 items-center justify-center rounded-full bg-gray-900 dark:bg-gray-700 text-white shadow-lg hover:scale-110 transition-all"
          >
            <span class="text-xl">{item.icon}</span>
            <span class="absolute right-full mr-3 whitespace-nowrap rounded bg-black/90 px-2 py-1 text-xs text-white opacity-0 group-hover:opacity-100 transition-opacity hidden md:block">
              {item.tooltip}
            </span>
          </button>
        )
      ))
    }
  </div>
</div>

<script is:inline>
  // --- 1. æŠ˜å å±•å¼€é€»è¾‘ ---
  const mainToggle = document.getElementById('main-toggle');
  const toolsContainer = document.getElementById('tools-container');
  const toggleIcon = document.getElementById('toggle-icon');
  let isOpen = false;

  // é»˜è®¤åœ¨ PC ç«¯ï¼ˆå®½å±ï¼‰å±•å¼€
  if (window.innerWidth > 1024) {
    isOpen = true;
    toolsContainer.classList.remove('translate-y-10', 'opacity-0', 'pointer-events-none');
    toggleIcon.style.transform = 'rotate(45deg)';
  }

  mainToggle.addEventListener('click', () => {
    isOpen = !isOpen;
    if (isOpen) {
      toolsContainer.classList.remove('translate-y-10', 'opacity-0', 'pointer-events-none');
      toggleIcon.style.transform = 'rotate(45deg)';
    } else {
      toolsContainer.classList.add('translate-y-10', 'opacity-0', 'pointer-events-none');
      toggleIcon.style.transform = 'rotate(0deg)';
    }
  });

  // --- 2. ä¸»é¢˜åˆ‡æ¢é€»è¾‘ ---
  const themeToggle = document.querySelector('[data-action="theme"]');
  if (themeToggle) {
    const updateIcon = () => {
      const isDark = document.documentElement.classList.contains('dark');
      themeToggle.querySelector('span').textContent = isDark ? 'ğŸŒ™' : 'â˜€ï¸';
    };

    themeToggle.addEventListener('click', () => {
      document.documentElement.classList.toggle('dark');
      const isDark = document.documentElement.classList.contains('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      updateIcon();
    });
    
    // åˆå§‹åŒ–å›¾æ ‡
    if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
    }
    updateIcon();
  }

  // --- 3. å›åˆ°é¡¶éƒ¨ ---
  const topBtn = document.querySelector('[data-action="top"]');
  if (topBtn) {
    topBtn.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  }

  // --- 4. å­—ä½“å¤§å° ---
  const fontBtn = document.querySelector('[data-action="fontSize"]');
  if (fontBtn) {
    let currentSize = localStorage.getItem('fontSize') || 'medium';
    document.documentElement.classList.add(`font-${currentSize}`);

    fontBtn.addEventListener('click', () => {
      const sizes = ['small', 'medium', 'large'];
      const next = sizes[(sizes.indexOf(currentSize) + 1) % 3];
      document.documentElement.classList.remove('font-small', 'font-medium', 'font-large');
      document.documentElement.classList.add(`font-${next}`);
      localStorage.setItem('fontSize', next);
      currentSize = next;
      fontBtn.querySelector('span').textContent = next === 'small' ? 'A-' : next === 'medium' ? 'A' : 'A+';
    });
  }
</script>

<style is:global>
  html.font-small { font-size: 14px; }
  html.font-medium { font-size: 16px; }
  html.font-large { font-size: 18px; }
</style>